<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
   "http://www.w3.org/TR/html4/strict.dtd">
<!--
generated by Pygments <https://pygments.org/>
Copyright 2006-2024 by the Pygments team.
Licensed under the BSD license, see LICENSE for details.
-->
<html>
<head>
  <title></title>
  <meta http-equiv="content-type" content="text/html; charset=None">
  <style type="text/css">
/*
generated by Pygments <https://pygments.org/>
Copyright 2006-2024 by the Pygments team.
Licensed under the BSD license, see LICENSE for details.
*/
pre { line-height: 125%; }
td.linenos .normal { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
span.linenos { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
td.linenos .special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
span.linenos.special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
body .hll { background-color: #49483e }
body { background: #272822; color: #f8f8f2 }
body .c { color: #959077 } /* Comment */
body .err { color: #ed007e; background-color: #1e0010 } /* Error */
body .esc { color: #f8f8f2 } /* Escape */
body .g { color: #f8f8f2 } /* Generic */
body .k { color: #66d9ef } /* Keyword */
body .l { color: #ae81ff } /* Literal */
body .n { color: #f8f8f2 } /* Name */
body .o { color: #ff4689 } /* Operator */
body .x { color: #f8f8f2 } /* Other */
body .p { color: #f8f8f2 } /* Punctuation */
body .ch { color: #959077 } /* Comment.Hashbang */
body .cm { color: #959077 } /* Comment.Multiline */
body .cp { color: #959077 } /* Comment.Preproc */
body .cpf { color: #959077 } /* Comment.PreprocFile */
body .c1 { color: #959077 } /* Comment.Single */
body .cs { color: #959077 } /* Comment.Special */
body .gd { color: #ff4689 } /* Generic.Deleted */
body .ge { color: #f8f8f2; font-style: italic } /* Generic.Emph */
body .ges { color: #f8f8f2; font-weight: bold; font-style: italic } /* Generic.EmphStrong */
body .gr { color: #f8f8f2 } /* Generic.Error */
body .gh { color: #f8f8f2 } /* Generic.Heading */
body .gi { color: #a6e22e } /* Generic.Inserted */
body .go { color: #66d9ef } /* Generic.Output */
body .gp { color: #ff4689; font-weight: bold } /* Generic.Prompt */
body .gs { color: #f8f8f2; font-weight: bold } /* Generic.Strong */
body .gu { color: #959077 } /* Generic.Subheading */
body .gt { color: #f8f8f2 } /* Generic.Traceback */
body .kc { color: #66d9ef } /* Keyword.Constant */
body .kd { color: #66d9ef } /* Keyword.Declaration */
body .kn { color: #ff4689 } /* Keyword.Namespace */
body .kp { color: #66d9ef } /* Keyword.Pseudo */
body .kr { color: #66d9ef } /* Keyword.Reserved */
body .kt { color: #66d9ef } /* Keyword.Type */
body .ld { color: #e6db74 } /* Literal.Date */
body .m { color: #ae81ff } /* Literal.Number */
body .s { color: #e6db74 } /* Literal.String */
body .na { color: #a6e22e } /* Name.Attribute */
body .nb { color: #f8f8f2 } /* Name.Builtin */
body .nc { color: #a6e22e } /* Name.Class */
body .no { color: #66d9ef } /* Name.Constant */
body .nd { color: #a6e22e } /* Name.Decorator */
body .ni { color: #f8f8f2 } /* Name.Entity */
body .ne { color: #a6e22e } /* Name.Exception */
body .nf { color: #a6e22e } /* Name.Function */
body .nl { color: #f8f8f2 } /* Name.Label */
body .nn { color: #f8f8f2 } /* Name.Namespace */
body .nx { color: #a6e22e } /* Name.Other */
body .py { color: #f8f8f2 } /* Name.Property */
body .nt { color: #ff4689 } /* Name.Tag */
body .nv { color: #f8f8f2 } /* Name.Variable */
body .ow { color: #ff4689 } /* Operator.Word */
body .pm { color: #f8f8f2 } /* Punctuation.Marker */
body .w { color: #f8f8f2 } /* Text.Whitespace */
body .mb { color: #ae81ff } /* Literal.Number.Bin */
body .mf { color: #ae81ff } /* Literal.Number.Float */
body .mh { color: #ae81ff } /* Literal.Number.Hex */
body .mi { color: #ae81ff } /* Literal.Number.Integer */
body .mo { color: #ae81ff } /* Literal.Number.Oct */
body .sa { color: #e6db74 } /* Literal.String.Affix */
body .sb { color: #e6db74 } /* Literal.String.Backtick */
body .sc { color: #e6db74 } /* Literal.String.Char */
body .dl { color: #e6db74 } /* Literal.String.Delimiter */
body .sd { color: #e6db74 } /* Literal.String.Doc */
body .s2 { color: #e6db74 } /* Literal.String.Double */
body .se { color: #ae81ff } /* Literal.String.Escape */
body .sh { color: #e6db74 } /* Literal.String.Heredoc */
body .si { color: #e6db74 } /* Literal.String.Interpol */
body .sx { color: #e6db74 } /* Literal.String.Other */
body .sr { color: #e6db74 } /* Literal.String.Regex */
body .s1 { color: #e6db74 } /* Literal.String.Single */
body .ss { color: #e6db74 } /* Literal.String.Symbol */
body .bp { color: #f8f8f2 } /* Name.Builtin.Pseudo */
body .fm { color: #a6e22e } /* Name.Function.Magic */
body .vc { color: #f8f8f2 } /* Name.Variable.Class */
body .vg { color: #f8f8f2 } /* Name.Variable.Global */
body .vi { color: #f8f8f2 } /* Name.Variable.Instance */
body .vm { color: #f8f8f2 } /* Name.Variable.Magic */
body .il { color: #ae81ff } /* Literal.Number.Integer.Long */

  </style>
</head>
<body>
<h2></h2>

<div class="source"><pre><span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;Untitled0.ipynb</span>

<span class="sd">Automatically generated by Colab.</span>

<span class="sd">Original file is located at</span>
<span class="sd">    https://colab.research.google.com/drive/1xVfsCGmOlE7izk2VsfknoYEiaXs6GbhU</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c1"># Install and update statsmodels</span>
<span class="err">!</span><span class="n">pip</span> <span class="n">install</span> <span class="o">--</span><span class="n">upgrade</span> <span class="n">statsmodels</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">statsmodels.tsa.arima.model</span> <span class="kn">import</span> <span class="n">ARIMA</span>
<span class="kn">from</span> <span class="nn">statsmodels.tsa.stattools</span> <span class="kn">import</span> <span class="n">adfuller</span><span class="p">,</span> <span class="n">kpss</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">statsmodels.tsa.stattools</span> <span class="kn">import</span> <span class="n">engle_granger</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;engle_granger not available. Using Johansen test only for cointegration.&quot;</span><span class="p">)</span>
    <span class="n">engle_granger</span> <span class="o">=</span> <span class="kc">None</span>
<span class="kn">from</span> <span class="nn">statsmodels.tsa.vector_ar.vecm</span> <span class="kn">import</span> <span class="n">coint_johansen</span>
<span class="kn">from</span> <span class="nn">statsmodels.graphics.tsaplots</span> <span class="kn">import</span> <span class="n">plot_acf</span><span class="p">,</span> <span class="n">plot_pacf</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">google.colab</span> <span class="kn">import</span> <span class="n">files</span>

<span class="c1"># Function to upload a single file and return its name</span>
<span class="k">def</span> <span class="nf">upload_file</span><span class="p">(</span><span class="n">prompt_message</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">prompt_message</span><span class="p">)</span>
    <span class="n">uploaded</span> <span class="o">=</span> <span class="n">files</span><span class="o">.</span><span class="n">upload</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">uploaded</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="s2">&quot;No file uploaded.&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">uploaded</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># Upload three Excel files individually</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">amazon_file</span> <span class="o">=</span> <span class="n">upload_file</span><span class="p">(</span><span class="s2">&quot;Please upload Amazon3min.xlsx&quot;</span><span class="p">)</span>
    <span class="n">nvda_file</span> <span class="o">=</span> <span class="n">upload_file</span><span class="p">(</span><span class="s2">&quot;Please upload Nvda3min.xlsx&quot;</span><span class="p">)</span>
    <span class="n">meta_file</span> <span class="o">=</span> <span class="n">upload_file</span><span class="p">(</span><span class="s2">&quot;Please upload Meta3min.xlsx&quot;</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">FileNotFoundError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Ensure all three files are uploaded when prompted.&quot;</span><span class="p">)</span>
    <span class="k">raise</span>

<span class="c1"># List uploaded files to verify</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Uploaded files:&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">amazon_file</span><span class="p">,</span> <span class="n">nvda_file</span><span class="p">,</span> <span class="n">meta_file</span><span class="p">])</span>

<span class="c1"># Read Excel files</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">amazon_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">amazon_file</span><span class="p">)</span>
    <span class="n">nvda_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">nvda_file</span><span class="p">)</span>
    <span class="n">meta_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">meta_file</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error reading Excel files: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Ensure files are valid Excel files with a &#39;Close&#39; column.&quot;</span><span class="p">)</span>
    <span class="k">raise</span>

<span class="c1"># Extract and preprocess closing prices</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">amazon_close</span> <span class="o">=</span> <span class="n">amazon_data</span><span class="p">[</span><span class="s1">&#39;Close&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">nvda_close</span> <span class="o">=</span> <span class="n">nvda_data</span><span class="p">[</span><span class="s1">&#39;Close&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">meta_close</span> <span class="o">=</span> <span class="n">meta_data</span><span class="p">[</span><span class="s1">&#39;Close&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">amazon_close</span><span class="o">.</span><span class="n">empty</span> <span class="ow">or</span> <span class="n">nvda_close</span><span class="o">.</span><span class="n">empty</span> <span class="ow">or</span> <span class="n">meta_close</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;One or more &#39;Close&#39; columns are empty after removing NaN.&quot;</span><span class="p">)</span>
    <span class="c1"># Align series lengths</span>
    <span class="n">min_len</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">amazon_close</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">nvda_close</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">meta_close</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">min_len</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">amazon_close</span><span class="p">)</span> <span class="ow">or</span> <span class="n">min_len</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">nvda_close</span><span class="p">)</span> <span class="ow">or</span> <span class="n">min_len</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">meta_close</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Warning: Series lengths differ. Truncated to </span><span class="si">{</span><span class="n">min_len</span><span class="si">}</span><span class="s2"> observations.&quot;</span><span class="p">)</span>
        <span class="n">amazon_close</span> <span class="o">=</span> <span class="n">amazon_close</span><span class="p">[:</span><span class="n">min_len</span><span class="p">]</span>
        <span class="n">nvda_close</span> <span class="o">=</span> <span class="n">nvda_close</span><span class="p">[:</span><span class="n">min_len</span><span class="p">]</span>
        <span class="n">meta_close</span> <span class="o">=</span> <span class="n">meta_close</span><span class="p">[:</span><span class="n">min_len</span><span class="p">]</span>
    <span class="c1"># Log-transform to reduce scale differences</span>
    <span class="n">amazon_close</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">amazon_close</span><span class="p">)</span>
    <span class="n">nvda_close</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">nvda_close</span><span class="p">)</span>
    <span class="n">meta_close</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">meta_close</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error: &#39;Close&#39; column not found in one of the files: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">raise</span>
<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error preprocessing data: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">raise</span>

<span class="c1"># Function for unit root tests</span>
<span class="k">def</span> <span class="nf">unit_root_tests</span><span class="p">(</span><span class="n">series</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Unit Root Tests for </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">)</span>

    <span class="c1"># ADF Test</span>
    <span class="n">adf_result</span> <span class="o">=</span> <span class="n">adfuller</span><span class="p">(</span><span class="n">series</span><span class="p">,</span> <span class="n">autolag</span><span class="o">=</span><span class="s1">&#39;AIC&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ADF Test:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Test Statistic: </span><span class="si">{</span><span class="n">adf_result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;P-value: </span><span class="si">{</span><span class="n">adf_result</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Stationary&quot;</span> <span class="k">if</span> <span class="n">adf_result</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.05</span> <span class="k">else</span> <span class="s2">&quot;Non-stationary&quot;</span><span class="p">)</span>

    <span class="c1"># KPSS Test</span>
    <span class="n">kpss_result</span> <span class="o">=</span> <span class="n">kpss</span><span class="p">(</span><span class="n">series</span><span class="p">,</span> <span class="n">regression</span><span class="o">=</span><span class="s1">&#39;c&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">KPSS Test:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Test Statistic: </span><span class="si">{</span><span class="n">kpss_result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;P-value: </span><span class="si">{</span><span class="n">kpss_result</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Stationary&quot;</span> <span class="k">if</span> <span class="n">kpss_result</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.05</span> <span class="k">else</span> <span class="s2">&quot;Non-stationary&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">adf_result</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

<span class="c1"># Function to plot and display correlogram</span>
<span class="k">def</span> <span class="nf">plot_correlogram</span><span class="p">(</span><span class="n">series</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

    <span class="c1"># ACF plot</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">)</span>
    <span class="n">plot_acf</span><span class="p">(</span><span class="n">series</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">(),</span> <span class="n">lags</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;ACF - </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="c1"># PACF plot</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">)</span>
    <span class="n">plot_pacf</span><span class="p">(</span><span class="n">series</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">(),</span> <span class="n">lags</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;PACF - </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;correlogram_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">.png&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Correlogram saved as &#39;correlogram_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">.png&#39;&quot;</span><span class="p">)</span>

<span class="c1"># Function to plot cointegration graphs for pairs</span>
<span class="k">def</span> <span class="nf">plot_cointegration_pair</span><span class="p">(</span><span class="n">series1</span><span class="p">,</span> <span class="n">series2</span><span class="p">,</span> <span class="n">name1</span><span class="p">,</span> <span class="n">name2</span><span class="p">,</span> <span class="n">eg_result</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pair_suffix</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
    <span class="c1"># Standardize series for comparability</span>
    <span class="n">series1_std</span> <span class="o">=</span> <span class="p">(</span><span class="n">series1</span> <span class="o">-</span> <span class="n">series1</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span> <span class="o">/</span> <span class="n">series1</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
    <span class="n">series2_std</span> <span class="o">=</span> <span class="p">(</span><span class="n">series2</span> <span class="o">-</span> <span class="n">series2</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span> <span class="o">/</span> <span class="n">series2</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>

    <span class="c1"># Plot standardized prices</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">series1_std</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">name1</span><span class="si">}</span><span class="s1"> (standardized)&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">series2_std</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">name2</span><span class="si">}</span><span class="s1"> (standardized)&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Standardized Closing Prices: </span><span class="si">{</span><span class="n">name1</span><span class="si">}</span><span class="s1"> vs </span><span class="si">{</span><span class="n">name2</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Standardized Price&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;cointegration_prices_</span><span class="si">{</span><span class="n">pair_suffix</span><span class="si">}</span><span class="s1">.png&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cointegration price plot saved as &#39;cointegration_prices_</span><span class="si">{</span><span class="n">pair_suffix</span><span class="si">}</span><span class="s2">.png&#39;&quot;</span><span class="p">)</span>

    <span class="c1"># Plot Engle-Granger residual if cointegrated</span>
    <span class="k">if</span> <span class="n">eg_result</span> <span class="ow">and</span> <span class="n">eg_result</span><span class="o">.</span><span class="n">pvalue</span> <span class="o">&lt;</span> <span class="mf">0.05</span><span class="p">:</span>
        <span class="n">residuals</span> <span class="o">=</span> <span class="n">eg_result</span><span class="o">.</span><span class="n">resid</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">residuals</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Engle-Granger Cointegration Residual&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Engle-Granger Cointegration Residual: </span><span class="si">{</span><span class="n">name1</span><span class="si">}</span><span class="s1"> vs </span><span class="si">{</span><span class="n">name2</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Residual&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;cointegration_residual_</span><span class="si">{</span><span class="n">pair_suffix</span><span class="si">}</span><span class="s1">.png&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Engle-Granger residual plot saved as &#39;cointegration_residual_</span><span class="si">{</span><span class="n">pair_suffix</span><span class="si">}</span><span class="s2">.png&#39;&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No Engle-Granger residual plot for </span><span class="si">{</span><span class="n">name1</span><span class="si">}</span><span class="s2"> vs </span><span class="si">{</span><span class="n">name2</span><span class="si">}</span><span class="s2"> (no cointegration or test unavailable).&quot;</span><span class="p">)</span>

<span class="c1"># Function to plot Johansen cointegrating relationship</span>
<span class="k">def</span> <span class="nf">plot_johansen_cointegration</span><span class="p">(</span><span class="n">series1</span><span class="p">,</span> <span class="n">series2</span><span class="p">,</span> <span class="n">series3</span><span class="p">,</span> <span class="n">name1</span><span class="p">,</span> <span class="n">name2</span><span class="p">,</span> <span class="n">name3</span><span class="p">,</span> <span class="n">johansen_result</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">johansen_result</span> <span class="ow">and</span> <span class="n">johansen_result</span><span class="o">.</span><span class="n">lr1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">johansen_result</span><span class="o">.</span><span class="n">cvt</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]:</span>
        <span class="c1"># Use the first eigenvector for the cointegrating relationship</span>
        <span class="n">weights</span> <span class="o">=</span> <span class="n">johansen_result</span><span class="o">.</span><span class="n">evec</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>  <span class="c1"># First cointegrating vector</span>
        <span class="n">cointegrating_series</span> <span class="o">=</span> <span class="n">series1</span> <span class="o">*</span> <span class="n">weights</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">series2</span> <span class="o">*</span> <span class="n">weights</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">series3</span> <span class="o">*</span> <span class="n">weights</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">cointegrating_series</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Johansen Cointegrating Relationship&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;purple&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">cointegrating_series</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Johansen Cointegrating Relationship: </span><span class="si">{</span><span class="n">name1</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="n">name2</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="n">name3</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Cointegrating Series&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;johansen_cointegration.png&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Johansen cointegration plot saved as &#39;johansen_cointegration.png&#39;&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No Johansen cointegration plot (no cointegration or test failed).&quot;</span><span class="p">)</span>

<span class="c1"># Perform unit root tests</span>
<span class="n">amazon_pval</span> <span class="o">=</span> <span class="n">unit_root_tests</span><span class="p">(</span><span class="n">amazon_close</span><span class="p">,</span> <span class="s2">&quot;Amazon&quot;</span><span class="p">)</span>
<span class="n">nvda_pval</span> <span class="o">=</span> <span class="n">unit_root_tests</span><span class="p">(</span><span class="n">nvda_close</span><span class="p">,</span> <span class="s2">&quot;NVDA&quot;</span><span class="p">)</span>
<span class="n">meta_pval</span> <span class="o">=</span> <span class="n">unit_root_tests</span><span class="p">(</span><span class="n">meta_close</span><span class="p">,</span> <span class="s2">&quot;Meta&quot;</span><span class="p">)</span>

<span class="c1"># Difference series if non-stationary</span>
<span class="n">amazon_series</span> <span class="o">=</span> <span class="n">amazon_close</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span> <span class="k">if</span> <span class="n">amazon_pval</span> <span class="o">&gt;</span> <span class="mf">0.05</span> <span class="k">else</span> <span class="n">amazon_close</span>
<span class="n">nvda_series</span> <span class="o">=</span> <span class="n">nvda_close</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span> <span class="k">if</span> <span class="n">nvda_pval</span> <span class="o">&gt;</span> <span class="mf">0.05</span> <span class="k">else</span> <span class="n">nvda_close</span>
<span class="n">meta_series</span> <span class="o">=</span> <span class="n">meta_close</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span> <span class="k">if</span> <span class="n">meta_pval</span> <span class="o">&gt;</span> <span class="mf">0.05</span> <span class="k">else</span> <span class="n">meta_close</span>

<span class="c1"># Plot and display correlograms</span>
<span class="n">plot_correlogram</span><span class="p">(</span><span class="n">amazon_series</span><span class="p">,</span> <span class="s2">&quot;Amazon&quot;</span><span class="p">)</span>
<span class="n">plot_correlogram</span><span class="p">(</span><span class="n">nvda_series</span><span class="p">,</span> <span class="s2">&quot;NVDA&quot;</span><span class="p">)</span>
<span class="n">plot_correlogram</span><span class="p">(</span><span class="n">meta_series</span><span class="p">,</span> <span class="s2">&quot;Meta&quot;</span><span class="p">)</span>

<span class="c1"># Fit ARMA models (ARMA(1,1)) and generate forecasts</span>
<span class="k">def</span> <span class="nf">fit_arma_and_forecast</span><span class="p">(</span><span class="n">series</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">ARIMA</span><span class="p">(</span><span class="n">series</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">ARMA(1,1) Model Results for </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="c1"># Generate 10-step-ahead forecast</span>
        <span class="n">forecast</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">get_forecast</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">forecast_mean</span> <span class="o">=</span> <span class="n">forecast</span><span class="o">.</span><span class="n">predicted_mean</span>
        <span class="n">forecast_ci</span> <span class="o">=</span> <span class="n">forecast</span><span class="o">.</span><span class="n">conf_int</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">10-Step-Ahead Forecast for </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">)</span>
        <span class="n">forecast_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
            <span class="s1">&#39;Forecast&#39;</span><span class="p">:</span> <span class="n">forecast_mean</span><span class="p">,</span>
            <span class="s1">&#39;Lower CI&#39;</span><span class="p">:</span> <span class="n">forecast_ci</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="s1">&#39;Upper CI&#39;</span><span class="p">:</span> <span class="n">forecast_ci</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="p">})</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">forecast_df</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">results</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error fitting ARMA model or forecasting for </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

<span class="n">amazon_arma</span> <span class="o">=</span> <span class="n">fit_arma_and_forecast</span><span class="p">(</span><span class="n">amazon_series</span><span class="p">,</span> <span class="s2">&quot;Amazon&quot;</span><span class="p">)</span>
<span class="n">nvda_arma</span> <span class="o">=</span> <span class="n">fit_arma_and_forecast</span><span class="p">(</span><span class="n">nvda_series</span><span class="p">,</span> <span class="s2">&quot;NVDA&quot;</span><span class="p">)</span>
<span class="n">meta_arma</span> <span class="o">=</span> <span class="n">fit_arma_and_forecast</span><span class="p">(</span><span class="n">meta_series</span><span class="p">,</span> <span class="s2">&quot;Meta&quot;</span><span class="p">)</span>

<span class="c1"># Cointegration test for pairs</span>
<span class="k">def</span> <span class="nf">cointegration_test_pair</span><span class="p">(</span><span class="n">series1</span><span class="p">,</span> <span class="n">series2</span><span class="p">,</span> <span class="n">name1</span><span class="p">,</span> <span class="n">name2</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Cointegration Test between </span><span class="si">{</span><span class="n">name1</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">name2</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">)</span>
    <span class="n">eg_result</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># Engle-Granger test (if available)</span>
    <span class="k">if</span> <span class="n">engle_granger</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">eg_result</span> <span class="o">=</span> <span class="n">engle_granger</span><span class="p">(</span><span class="n">series1</span><span class="p">,</span> <span class="n">series2</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Engle-Granger Test:&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Test Statistic: </span><span class="si">{</span><span class="n">eg_result</span><span class="o">.</span><span class="n">stat</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;P-value: </span><span class="si">{</span><span class="n">eg_result</span><span class="o">.</span><span class="n">pvalue</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Cointegrated&quot;</span> <span class="k">if</span> <span class="n">eg_result</span><span class="o">.</span><span class="n">pvalue</span> <span class="o">&lt;</span> <span class="mf">0.05</span> <span class="k">else</span> <span class="s2">&quot;Not Cointegrated&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Engle-Granger test failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">eg_result</span>

<span class="c1"># Johansen test for all three stocks</span>
<span class="k">def</span> <span class="nf">cointegration_test_johansen</span><span class="p">(</span><span class="n">series1</span><span class="p">,</span> <span class="n">series2</span><span class="p">,</span> <span class="n">series3</span><span class="p">,</span> <span class="n">name1</span><span class="p">,</span> <span class="n">name2</span><span class="p">,</span> <span class="n">name3</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Johansen Cointegration Test for </span><span class="si">{</span><span class="n">name1</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">name2</span><span class="si">}</span><span class="s2">, and </span><span class="si">{</span><span class="n">name3</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="n">name1</span><span class="p">:</span> <span class="n">series1</span><span class="p">,</span> <span class="n">name2</span><span class="p">:</span> <span class="n">series2</span><span class="p">,</span> <span class="n">name3</span><span class="p">:</span> <span class="n">series3</span><span class="p">})</span>
        <span class="n">johansen_result</span> <span class="o">=</span> <span class="n">coint_johansen</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">det_order</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">k_ar_diff</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Johansen Test:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Trace Statistic (r=0): </span><span class="si">{</span><span class="n">johansen_result</span><span class="o">.</span><span class="n">lr1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Critical Value (5%, r=0): </span><span class="si">{</span><span class="n">johansen_result</span><span class="o">.</span><span class="n">cvt</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Cointegrated (at least one relationship)&quot;</span> <span class="k">if</span> <span class="n">johansen_result</span><span class="o">.</span><span class="n">lr1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">johansen_result</span><span class="o">.</span><span class="n">cvt</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="k">else</span> <span class="s2">&quot;Not Cointegrated&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">johansen_result</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Johansen test failed (skipped): </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Relying on pairwise Engle-Granger tests for cointegration results.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

<span class="c1"># Perform cointegration tests</span>
<span class="n">eg_result_amzn_nvda</span> <span class="o">=</span> <span class="n">cointegration_test_pair</span><span class="p">(</span><span class="n">amazon_close</span><span class="p">,</span> <span class="n">nvda_close</span><span class="p">,</span> <span class="s2">&quot;Amazon&quot;</span><span class="p">,</span> <span class="s2">&quot;NVDA&quot;</span><span class="p">)</span>
<span class="n">eg_result_amzn_meta</span> <span class="o">=</span> <span class="n">cointegration_test_pair</span><span class="p">(</span><span class="n">amazon_close</span><span class="p">,</span> <span class="n">meta_close</span><span class="p">,</span> <span class="s2">&quot;Amazon&quot;</span><span class="p">,</span> <span class="s2">&quot;Meta&quot;</span><span class="p">)</span>
<span class="n">eg_result_nvda_meta</span> <span class="o">=</span> <span class="n">cointegration_test_pair</span><span class="p">(</span><span class="n">nvda_close</span><span class="p">,</span> <span class="n">meta_close</span><span class="p">,</span> <span class="s2">&quot;NVDA&quot;</span><span class="p">,</span> <span class="s2">&quot;Meta&quot;</span><span class="p">)</span>
<span class="n">johansen_result</span> <span class="o">=</span> <span class="n">cointegration_test_johansen</span><span class="p">(</span><span class="n">amazon_close</span><span class="p">,</span> <span class="n">nvda_close</span><span class="p">,</span> <span class="n">meta_close</span><span class="p">,</span> <span class="s2">&quot;Amazon&quot;</span><span class="p">,</span> <span class="s2">&quot;NVDA&quot;</span><span class="p">,</span> <span class="s2">&quot;Meta&quot;</span><span class="p">)</span>

<span class="c1"># Plot cointegration for pairs</span>
<span class="n">plot_cointegration_pair</span><span class="p">(</span><span class="n">amazon_close</span><span class="p">,</span> <span class="n">nvda_close</span><span class="p">,</span> <span class="s2">&quot;Amazon&quot;</span><span class="p">,</span> <span class="s2">&quot;NVDA&quot;</span><span class="p">,</span> <span class="n">eg_result_amzn_nvda</span><span class="p">,</span> <span class="s2">&quot;amzn_nvda&quot;</span><span class="p">)</span>
<span class="n">plot_cointegration_pair</span><span class="p">(</span><span class="n">amazon_close</span><span class="p">,</span> <span class="n">meta_close</span><span class="p">,</span> <span class="s2">&quot;Amazon&quot;</span><span class="p">,</span> <span class="s2">&quot;Meta&quot;</span><span class="p">,</span> <span class="n">eg_result_amzn_meta</span><span class="p">,</span> <span class="s2">&quot;amzn_meta&quot;</span><span class="p">)</span>
<span class="n">plot_cointegration_pair</span><span class="p">(</span><span class="n">nvda_close</span><span class="p">,</span> <span class="n">meta_close</span><span class="p">,</span> <span class="s2">&quot;NVDA&quot;</span><span class="p">,</span> <span class="s2">&quot;Meta&quot;</span><span class="p">,</span> <span class="n">eg_result_nvda_meta</span><span class="p">,</span> <span class="s2">&quot;nvda_meta&quot;</span><span class="p">)</span>

<span class="c1"># Plot Johansen cointegrating relationship</span>
<span class="n">plot_johansen_cointegration</span><span class="p">(</span><span class="n">amazon_close</span><span class="p">,</span> <span class="n">nvda_close</span><span class="p">,</span> <span class="n">meta_close</span><span class="p">,</span> <span class="s2">&quot;Amazon&quot;</span><span class="p">,</span> <span class="s2">&quot;NVDA&quot;</span><span class="p">,</span> <span class="s2">&quot;Meta&quot;</span><span class="p">,</span> <span class="n">johansen_result</span><span class="p">)</span>

<span class="c1"># Interpretation of Results</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Interpretation of Results:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;1. Unit Root Tests:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   - ADF Test: P-value &lt; 0.05 suggests stationarity (rejects non-stationarity).&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   - KPSS Test: P-value &gt; 0.05 suggests stationarity (fails to reject stationarity).&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   - Non-stationary series were differenced for ARMA modeling.&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;2. Correlograms:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   - ACF and PACF plots show the correlation structure for Amazon, NVDA, and Meta.&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   - Significant spikes at early lags (e.g., lag 1) justify the ARMA(1,1) model.&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   - Plots saved as &#39;correlogram_</span><span class="si">{stock}</span><span class="s2">.png&#39;.&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;3. ARMA Models:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   - ARMA(1,1) models capture short-term price dynamics for each stock.&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   - Significant coefficients (p &lt; 0.05) indicate a good fit.&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   - Check model diagnostics in the summary for adequacy.&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;4. Forecasts:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   - 10-step-ahead forecasts (30 minutes for 3-min data) predict price movements.&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   - Confidence intervals show the range of uncertainty; wider intervals indicate higher uncertainty.&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;5. Cointegration:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   - Tests for stable long-run relationships between Amazon, NVDA, and Meta.&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   - Pairwise Engle-Granger Tests: P-value &lt; 0.05 indicates cointegration for each pair (Amazon-NVDA, Amazon-Meta, NVDA-Meta).&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   - Johansen Test: Trace statistic &gt; critical value (5%) indicates at least one cointegrating relationship among all three stocks.&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   - Cointegration suggests linked price movements, useful for pairs trading or portfolio management.&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   - No cointegration implies prices may drift apart, indicating independent trends.&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   - Cointegration Plots:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;     - Standardized Prices: Show price co-movement for each pair (saved as &#39;cointegration_prices_</span><span class="si">{pair}</span><span class="s2">.png&#39;).&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;     - Engle-Granger Residuals: Stationary residuals for cointegrated pairs (saved as &#39;cointegration_residual_</span><span class="si">{pair}</span><span class="s2">.png&#39;).&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;     - Johansen Cointegrating Relationship: Stationary series for all three stocks, if cointegrated (saved as &#39;johansen_cointegration.png&#39;).&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Note: If Johansen test fails, rely on pairwise Engle-Granger results. Ensure data is clean (no NaN, numeric). Review test statistics, p-values, plots, and forecasts carefully.&quot;</span><span class="p">)</span>

<span class="c1"># Install and update statsmodels</span>
<span class="err">!</span><span class="n">pip</span> <span class="n">install</span> <span class="o">--</span><span class="n">upgrade</span> <span class="n">statsmodels</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">statsmodels.tsa.arima.model</span> <span class="kn">import</span> <span class="n">ARIMA</span>
<span class="kn">from</span> <span class="nn">statsmodels.tsa.stattools</span> <span class="kn">import</span> <span class="n">adfuller</span><span class="p">,</span> <span class="n">kpss</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">statsmodels.tsa.stattools</span> <span class="kn">import</span> <span class="n">engle_granger</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;engle_granger not available. Using Johansen test only for cointegration.&quot;</span><span class="p">)</span>
    <span class="n">engle_granger</span> <span class="o">=</span> <span class="kc">None</span>
<span class="kn">from</span> <span class="nn">statsmodels.tsa.vector_ar.vecm</span> <span class="kn">import</span> <span class="n">coint_johansen</span>
<span class="kn">from</span> <span class="nn">statsmodels.graphics.tsaplots</span> <span class="kn">import</span> <span class="n">plot_acf</span><span class="p">,</span> <span class="n">plot_pacf</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">google.colab</span> <span class="kn">import</span> <span class="n">files</span>

<span class="c1"># Function to upload a single file and return its name</span>
<span class="k">def</span> <span class="nf">upload_file</span><span class="p">(</span><span class="n">prompt_message</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">prompt_message</span><span class="p">)</span>
    <span class="n">uploaded</span> <span class="o">=</span> <span class="n">files</span><span class="o">.</span><span class="n">upload</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">uploaded</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="s2">&quot;No file uploaded.&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">uploaded</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># Upload three Excel files individually</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">amazon_file</span> <span class="o">=</span> <span class="n">upload_file</span><span class="p">(</span><span class="s2">&quot;Please upload Amazon1min.xlsx&quot;</span><span class="p">)</span>
    <span class="n">nvda_file</span> <span class="o">=</span> <span class="n">upload_file</span><span class="p">(</span><span class="s2">&quot;Please upload Nvda1min.xlsx&quot;</span><span class="p">)</span>
    <span class="n">meta_file</span> <span class="o">=</span> <span class="n">upload_file</span><span class="p">(</span><span class="s2">&quot;Please upload Meta1min.xlsx&quot;</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">FileNotFoundError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Ensure all three files are uploaded when prompted.&quot;</span><span class="p">)</span>
    <span class="k">raise</span>

<span class="c1"># List uploaded files to verify</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Uploaded files:&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">amazon_file</span><span class="p">,</span> <span class="n">nvda_file</span><span class="p">,</span> <span class="n">meta_file</span><span class="p">])</span>

<span class="c1"># Read Excel files</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">amazon_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">amazon_file</span><span class="p">)</span>
    <span class="n">nvda_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">nvda_file</span><span class="p">)</span>
    <span class="n">meta_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">meta_file</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error reading Excel files: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Ensure files are valid Excel files with a &#39;Close&#39; column.&quot;</span><span class="p">)</span>
    <span class="k">raise</span>

<span class="c1"># Extract and preprocess closing prices</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">amazon_close</span> <span class="o">=</span> <span class="n">amazon_data</span><span class="p">[</span><span class="s1">&#39;Close&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">nvda_close</span> <span class="o">=</span> <span class="n">nvda_data</span><span class="p">[</span><span class="s1">&#39;Close&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">meta_close</span> <span class="o">=</span> <span class="n">meta_data</span><span class="p">[</span><span class="s1">&#39;Close&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">amazon_close</span><span class="o">.</span><span class="n">empty</span> <span class="ow">or</span> <span class="n">nvda_close</span><span class="o">.</span><span class="n">empty</span> <span class="ow">or</span> <span class="n">meta_close</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;One or more &#39;Close&#39; columns are empty after removing NaN.&quot;</span><span class="p">)</span>
    <span class="c1"># Align series lengths</span>
    <span class="n">min_len</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">amazon_close</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">nvda_close</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">meta_close</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">min_len</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">amazon_close</span><span class="p">)</span> <span class="ow">or</span> <span class="n">min_len</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">nvda_close</span><span class="p">)</span> <span class="ow">or</span> <span class="n">min_len</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">meta_close</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Warning: Series lengths differ. Truncated to </span><span class="si">{</span><span class="n">min_len</span><span class="si">}</span><span class="s2"> observations.&quot;</span><span class="p">)</span>
        <span class="n">amazon_close</span> <span class="o">=</span> <span class="n">amazon_close</span><span class="p">[:</span><span class="n">min_len</span><span class="p">]</span>
        <span class="n">nvda_close</span> <span class="o">=</span> <span class="n">nvda_close</span><span class="p">[:</span><span class="n">min_len</span><span class="p">]</span>
        <span class="n">meta_close</span> <span class="o">=</span> <span class="n">meta_close</span><span class="p">[:</span><span class="n">min_len</span><span class="p">]</span>
    <span class="c1"># Log-transform to reduce scale differences</span>
    <span class="n">amazon_close</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">amazon_close</span><span class="p">)</span>
    <span class="n">nvda_close</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">nvda_close</span><span class="p">)</span>
    <span class="n">meta_close</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">meta_close</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error: &#39;Close&#39; column not found in one of the files: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">raise</span>
<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error preprocessing data: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">raise</span>

<span class="c1"># Function for unit root tests</span>
<span class="k">def</span> <span class="nf">unit_root_tests</span><span class="p">(</span><span class="n">series</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Unit Root Tests for </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">)</span>

    <span class="c1"># ADF Test</span>
    <span class="n">adf_result</span> <span class="o">=</span> <span class="n">adfuller</span><span class="p">(</span><span class="n">series</span><span class="p">,</span> <span class="n">autolag</span><span class="o">=</span><span class="s1">&#39;AIC&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ADF Test:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Test Statistic: </span><span class="si">{</span><span class="n">adf_result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;P-value: </span><span class="si">{</span><span class="n">adf_result</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Stationary&quot;</span> <span class="k">if</span> <span class="n">adf_result</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.05</span> <span class="k">else</span> <span class="s2">&quot;Non-stationary&quot;</span><span class="p">)</span>

    <span class="c1"># KPSS Test</span>
    <span class="n">kpss_result</span> <span class="o">=</span> <span class="n">kpss</span><span class="p">(</span><span class="n">series</span><span class="p">,</span> <span class="n">regression</span><span class="o">=</span><span class="s1">&#39;c&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">KPSS Test:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Test Statistic: </span><span class="si">{</span><span class="n">kpss_result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;P-value: </span><span class="si">{</span><span class="n">kpss_result</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Stationary&quot;</span> <span class="k">if</span> <span class="n">kpss_result</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.05</span> <span class="k">else</span> <span class="s2">&quot;Non-stationary&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">adf_result</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

<span class="c1"># Function to plot and display correlogram</span>
<span class="k">def</span> <span class="nf">plot_correlogram</span><span class="p">(</span><span class="n">series</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

    <span class="c1"># ACF plot</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">)</span>
    <span class="n">plot_acf</span><span class="p">(</span><span class="n">series</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">(),</span> <span class="n">lags</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;ACF - </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="c1"># PACF plot</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">)</span>
    <span class="n">plot_pacf</span><span class="p">(</span><span class="n">series</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">(),</span> <span class="n">lags</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;PACF - </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;correlogram_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">.png&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Correlogram saved as &#39;correlogram_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">.png&#39;&quot;</span><span class="p">)</span>

<span class="c1"># Function to plot cointegration graphs for pairs</span>
<span class="k">def</span> <span class="nf">plot_cointegration_pair</span><span class="p">(</span><span class="n">series1</span><span class="p">,</span> <span class="n">series2</span><span class="p">,</span> <span class="n">name1</span><span class="p">,</span> <span class="n">name2</span><span class="p">,</span> <span class="n">eg_result</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pair_suffix</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
    <span class="c1"># Standardize series for comparability</span>
    <span class="n">series1_std</span> <span class="o">=</span> <span class="p">(</span><span class="n">series1</span> <span class="o">-</span> <span class="n">series1</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span> <span class="o">/</span> <span class="n">series1</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
    <span class="n">series2_std</span> <span class="o">=</span> <span class="p">(</span><span class="n">series2</span> <span class="o">-</span> <span class="n">series2</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span> <span class="o">/</span> <span class="n">series2</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>

    <span class="c1"># Plot standardized prices</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">series1_std</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">name1</span><span class="si">}</span><span class="s1"> (standardized)&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">series2_std</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">name2</span><span class="si">}</span><span class="s1"> (standardized)&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Standardized Closing Prices: </span><span class="si">{</span><span class="n">name1</span><span class="si">}</span><span class="s1"> vs </span><span class="si">{</span><span class="n">name2</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Standardized Price&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;cointegration_prices_</span><span class="si">{</span><span class="n">pair_suffix</span><span class="si">}</span><span class="s1">.png&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cointegration price plot saved as &#39;cointegration_prices_</span><span class="si">{</span><span class="n">pair_suffix</span><span class="si">}</span><span class="s2">.png&#39;&quot;</span><span class="p">)</span>

    <span class="c1"># Plot Engle-Granger residual if cointegrated</span>
    <span class="k">if</span> <span class="n">eg_result</span> <span class="ow">and</span> <span class="n">eg_result</span><span class="o">.</span><span class="n">pvalue</span> <span class="o">&lt;</span> <span class="mf">0.05</span><span class="p">:</span>
        <span class="n">residuals</span> <span class="o">=</span> <span class="n">eg_result</span><span class="o">.</span><span class="n">resid</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">residuals</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Engle-Granger Cointegration Residual&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Engle-Granger Cointegration Residual: </span><span class="si">{</span><span class="n">name1</span><span class="si">}</span><span class="s1"> vs </span><span class="si">{</span><span class="n">name2</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Residual&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;cointegration_residual_</span><span class="si">{</span><span class="n">pair_suffix</span><span class="si">}</span><span class="s1">.png&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Engle-Granger residual plot saved as &#39;cointegration_residual_</span><span class="si">{</span><span class="n">pair_suffix</span><span class="si">}</span><span class="s2">.png&#39;&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No Engle-Granger residual plot for </span><span class="si">{</span><span class="n">name1</span><span class="si">}</span><span class="s2"> vs </span><span class="si">{</span><span class="n">name2</span><span class="si">}</span><span class="s2"> (no cointegration or test unavailable).&quot;</span><span class="p">)</span>

<span class="c1"># Function to plot Johansen cointegrating relationship</span>
<span class="k">def</span> <span class="nf">plot_johansen_cointegration</span><span class="p">(</span><span class="n">series1</span><span class="p">,</span> <span class="n">series2</span><span class="p">,</span> <span class="n">series3</span><span class="p">,</span> <span class="n">name1</span><span class="p">,</span> <span class="n">name2</span><span class="p">,</span> <span class="n">name3</span><span class="p">,</span> <span class="n">johansen_result</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">johansen_result</span> <span class="ow">and</span> <span class="n">johansen_result</span><span class="o">.</span><span class="n">lr1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">johansen_result</span><span class="o">.</span><span class="n">cvt</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]:</span>
        <span class="c1"># Use the first eigenvector for the cointegrating relationship</span>
        <span class="n">weights</span> <span class="o">=</span> <span class="n">johansen_result</span><span class="o">.</span><span class="n">evec</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>  <span class="c1"># First cointegrating vector</span>
        <span class="n">cointegrating_series</span> <span class="o">=</span> <span class="n">series1</span> <span class="o">*</span> <span class="n">weights</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">series2</span> <span class="o">*</span> <span class="n">weights</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">series3</span> <span class="o">*</span> <span class="n">weights</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">cointegrating_series</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Johansen Cointegrating Relationship&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;purple&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">cointegrating_series</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Johansen Cointegrating Relationship: </span><span class="si">{</span><span class="n">name1</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="n">name2</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="n">name3</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Cointegrating Series&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;johansen_cointegration.png&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Johansen cointegration plot saved as &#39;johansen_cointegration.png&#39;&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No Johansen cointegration plot (no cointegration or test failed).&quot;</span><span class="p">)</span>

<span class="c1"># Perform unit root tests</span>
<span class="n">amazon_pval</span> <span class="o">=</span> <span class="n">unit_root_tests</span><span class="p">(</span><span class="n">amazon_close</span><span class="p">,</span> <span class="s2">&quot;Amazon&quot;</span><span class="p">)</span>
<span class="n">nvda_pval</span> <span class="o">=</span> <span class="n">unit_root_tests</span><span class="p">(</span><span class="n">nvda_close</span><span class="p">,</span> <span class="s2">&quot;NVDA&quot;</span><span class="p">)</span>
<span class="n">meta_pval</span> <span class="o">=</span> <span class="n">unit_root_tests</span><span class="p">(</span><span class="n">meta_close</span><span class="p">,</span> <span class="s2">&quot;Meta&quot;</span><span class="p">)</span>

<span class="c1"># Difference series if non-stationary</span>
<span class="n">amazon_series</span> <span class="o">=</span> <span class="n">amazon_close</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span> <span class="k">if</span> <span class="n">amazon_pval</span> <span class="o">&gt;</span> <span class="mf">0.05</span> <span class="k">else</span> <span class="n">amazon_close</span>
<span class="n">nvda_series</span> <span class="o">=</span> <span class="n">nvda_close</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span> <span class="k">if</span> <span class="n">nvda_pval</span> <span class="o">&gt;</span> <span class="mf">0.05</span> <span class="k">else</span> <span class="n">nvda_close</span>
<span class="n">meta_series</span> <span class="o">=</span> <span class="n">meta_close</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span> <span class="k">if</span> <span class="n">meta_pval</span> <span class="o">&gt;</span> <span class="mf">0.05</span> <span class="k">else</span> <span class="n">meta_close</span>

<span class="c1"># Plot and display correlograms</span>
<span class="n">plot_correlogram</span><span class="p">(</span><span class="n">amazon_series</span><span class="p">,</span> <span class="s2">&quot;Amazon&quot;</span><span class="p">)</span>
<span class="n">plot_correlogram</span><span class="p">(</span><span class="n">nvda_series</span><span class="p">,</span> <span class="s2">&quot;NVDA&quot;</span><span class="p">)</span>
<span class="n">plot_correlogram</span><span class="p">(</span><span class="n">meta_series</span><span class="p">,</span> <span class="s2">&quot;Meta&quot;</span><span class="p">)</span>

<span class="c1"># Fit ARMA models (ARMA(1,1)) and generate forecasts</span>
<span class="k">def</span> <span class="nf">fit_arma_and_forecast</span><span class="p">(</span><span class="n">series</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">ARIMA</span><span class="p">(</span><span class="n">series</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">ARMA(1,1) Model Results for </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="c1"># Generate 10-step-ahead forecast</span>
        <span class="n">forecast</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">get_forecast</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">forecast_mean</span> <span class="o">=</span> <span class="n">forecast</span><span class="o">.</span><span class="n">predicted_mean</span>
        <span class="n">forecast_ci</span> <span class="o">=</span> <span class="n">forecast</span><span class="o">.</span><span class="n">conf_int</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">10-Step-Ahead Forecast for </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">)</span>
        <span class="n">forecast_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
            <span class="s1">&#39;Forecast&#39;</span><span class="p">:</span> <span class="n">forecast_mean</span><span class="p">,</span>
            <span class="s1">&#39;Lower CI&#39;</span><span class="p">:</span> <span class="n">forecast_ci</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="s1">&#39;Upper CI&#39;</span><span class="p">:</span> <span class="n">forecast_ci</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="p">})</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">forecast_df</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">results</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error fitting ARMA model or forecasting for </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

<span class="n">amazon_arma</span> <span class="o">=</span> <span class="n">fit_arma_and_forecast</span><span class="p">(</span><span class="n">amazon_series</span><span class="p">,</span> <span class="s2">&quot;Amazon&quot;</span><span class="p">)</span>
<span class="n">nvda_arma</span> <span class="o">=</span> <span class="n">fit_arma_and_forecast</span><span class="p">(</span><span class="n">nvda_series</span><span class="p">,</span> <span class="s2">&quot;NVDA&quot;</span><span class="p">)</span>
<span class="n">meta_arma</span> <span class="o">=</span> <span class="n">fit_arma_and_forecast</span><span class="p">(</span><span class="n">meta_series</span><span class="p">,</span> <span class="s2">&quot;Meta&quot;</span><span class="p">)</span>

<span class="c1"># Cointegration test for pairs</span>
<span class="k">def</span> <span class="nf">cointegration_test_pair</span><span class="p">(</span><span class="n">series1</span><span class="p">,</span> <span class="n">series2</span><span class="p">,</span> <span class="n">name1</span><span class="p">,</span> <span class="n">name2</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Cointegration Test between </span><span class="si">{</span><span class="n">name1</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">name2</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">)</span>
    <span class="n">eg_result</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># Engle-Granger test (if available)</span>
    <span class="k">if</span> <span class="n">engle_granger</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">eg_result</span> <span class="o">=</span> <span class="n">engle_granger</span><span class="p">(</span><span class="n">series1</span><span class="p">,</span> <span class="n">series2</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Engle-Granger Test:&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Test Statistic: </span><span class="si">{</span><span class="n">eg_result</span><span class="o">.</span><span class="n">stat</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;P-value: </span><span class="si">{</span><span class="n">eg_result</span><span class="o">.</span><span class="n">pvalue</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Cointegrated&quot;</span> <span class="k">if</span> <span class="n">eg_result</span><span class="o">.</span><span class="n">pvalue</span> <span class="o">&lt;</span> <span class="mf">0.05</span> <span class="k">else</span> <span class="s2">&quot;Not Cointegrated&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Engle-Granger test failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">eg_result</span>

<span class="c1"># Johansen test for all three stocks</span>
<span class="k">def</span> <span class="nf">cointegration_test_johansen</span><span class="p">(</span><span class="n">series1</span><span class="p">,</span> <span class="n">series2</span><span class="p">,</span> <span class="n">series3</span><span class="p">,</span> <span class="n">name1</span><span class="p">,</span> <span class="n">name2</span><span class="p">,</span> <span class="n">name3</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Johansen Cointegration Test for </span><span class="si">{</span><span class="n">name1</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">name2</span><span class="si">}</span><span class="s2">, and </span><span class="si">{</span><span class="n">name3</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="n">name1</span><span class="p">:</span> <span class="n">series1</span><span class="p">,</span> <span class="n">name2</span><span class="p">:</span> <span class="n">series2</span><span class="p">,</span> <span class="n">name3</span><span class="p">:</span> <span class="n">series3</span><span class="p">})</span>
        <span class="n">johansen_result</span> <span class="o">=</span> <span class="n">coint_johansen</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">det_order</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">k_ar_diff</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Johansen Test:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Trace Statistic (r=0): </span><span class="si">{</span><span class="n">johansen_result</span><span class="o">.</span><span class="n">lr1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Critical Value (5%, r=0): </span><span class="si">{</span><span class="n">johansen_result</span><span class="o">.</span><span class="n">cvt</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Cointegrated (at least one relationship)&quot;</span> <span class="k">if</span> <span class="n">johansen_result</span><span class="o">.</span><span class="n">lr1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">johansen_result</span><span class="o">.</span><span class="n">cvt</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="k">else</span> <span class="s2">&quot;Not Cointegrated&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">johansen_result</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Johansen test failed (skipped): </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Relying on pairwise Engle-Granger tests for cointegration results.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

<span class="c1"># Perform cointegration tests</span>
<span class="n">eg_result_amzn_nvda</span> <span class="o">=</span> <span class="n">cointegration_test_pair</span><span class="p">(</span><span class="n">amazon_close</span><span class="p">,</span> <span class="n">nvda_close</span><span class="p">,</span> <span class="s2">&quot;Amazon&quot;</span><span class="p">,</span> <span class="s2">&quot;NVDA&quot;</span><span class="p">)</span>
<span class="n">eg_result_amzn_meta</span> <span class="o">=</span> <span class="n">cointegration_test_pair</span><span class="p">(</span><span class="n">amazon_close</span><span class="p">,</span> <span class="n">meta_close</span><span class="p">,</span> <span class="s2">&quot;Amazon&quot;</span><span class="p">,</span> <span class="s2">&quot;Meta&quot;</span><span class="p">)</span>
<span class="n">eg_result_nvda_meta</span> <span class="o">=</span> <span class="n">cointegration_test_pair</span><span class="p">(</span><span class="n">nvda_close</span><span class="p">,</span> <span class="n">meta_close</span><span class="p">,</span> <span class="s2">&quot;NVDA&quot;</span><span class="p">,</span> <span class="s2">&quot;Meta&quot;</span><span class="p">)</span>
<span class="n">johansen_result</span> <span class="o">=</span> <span class="n">cointegration_test_johansen</span><span class="p">(</span><span class="n">amazon_close</span><span class="p">,</span> <span class="n">nvda_close</span><span class="p">,</span> <span class="n">meta_close</span><span class="p">,</span> <span class="s2">&quot;Amazon&quot;</span><span class="p">,</span> <span class="s2">&quot;NVDA&quot;</span><span class="p">,</span> <span class="s2">&quot;Meta&quot;</span><span class="p">)</span>

<span class="c1"># Plot cointegration for pairs</span>
<span class="n">plot_cointegration_pair</span><span class="p">(</span><span class="n">amazon_close</span><span class="p">,</span> <span class="n">nvda_close</span><span class="p">,</span> <span class="s2">&quot;Amazon&quot;</span><span class="p">,</span> <span class="s2">&quot;NVDA&quot;</span><span class="p">,</span> <span class="n">eg_result_amzn_nvda</span><span class="p">,</span> <span class="s2">&quot;amzn_nvda&quot;</span><span class="p">)</span>
<span class="n">plot_cointegration_pair</span><span class="p">(</span><span class="n">amazon_close</span><span class="p">,</span> <span class="n">meta_close</span><span class="p">,</span> <span class="s2">&quot;Amazon&quot;</span><span class="p">,</span> <span class="s2">&quot;Meta&quot;</span><span class="p">,</span> <span class="n">eg_result_amzn_meta</span><span class="p">,</span> <span class="s2">&quot;amzn_meta&quot;</span><span class="p">)</span>
<span class="n">plot_cointegration_pair</span><span class="p">(</span><span class="n">nvda_close</span><span class="p">,</span> <span class="n">meta_close</span><span class="p">,</span> <span class="s2">&quot;NVDA&quot;</span><span class="p">,</span> <span class="s2">&quot;Meta&quot;</span><span class="p">,</span> <span class="n">eg_result_nvda_meta</span><span class="p">,</span> <span class="s2">&quot;nvda_meta&quot;</span><span class="p">)</span>

<span class="c1"># Plot Johansen cointegrating relationship</span>
<span class="n">plot_johansen_cointegration</span><span class="p">(</span><span class="n">amazon_close</span><span class="p">,</span> <span class="n">nvda_close</span><span class="p">,</span> <span class="n">meta_close</span><span class="p">,</span> <span class="s2">&quot;Amazon&quot;</span><span class="p">,</span> <span class="s2">&quot;NVDA&quot;</span><span class="p">,</span> <span class="s2">&quot;Meta&quot;</span><span class="p">,</span> <span class="n">johansen_result</span><span class="p">)</span>

<span class="c1"># Interpretation of Results</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Interpretation of Results:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;1. Unit Root Tests:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   - ADF Test: P-value &lt; 0.05 suggests stationarity (rejects non-stationarity).&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   - KPSS Test: P-value &gt; 0.05 suggests stationarity (fails to reject stationarity).&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   - Non-stationary series were differenced for ARMA modeling.&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;2. Correlograms:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   - ACF and PACF plots show the correlation structure for Amazon, NVDA, and Meta.&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   - Significant spikes at early lags (e.g., lag 1) justify the ARMA(1,1) model.&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   - Plots saved as &#39;correlogram_</span><span class="si">{stock}</span><span class="s2">.png&#39;.&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;3. ARMA Models:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   - ARMA(1,1) models capture short-term price dynamics for each stock.&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   - Significant coefficients (p &lt; 0.05) indicate a good fit.&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   - Check model diagnostics in the summary for adequacy.&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;4. Forecasts:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   - 10-step-ahead forecasts (10 minutes for 1-min data) predict price movements.&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   - Confidence intervals show the range of uncertainty; wider intervals indicate higher uncertainty.&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;5. Cointegration:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   - Tests for stable long-run relationships between Amazon, NVDA, and Meta.&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   - Pairwise Engle-Granger Tests: P-value &lt; 0.05 indicates cointegration for each pair (Amazon-NVDA, Amazon-Meta, NVDA-Meta).&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   - Johansen Test: Trace statistic &gt; critical value (5%) indicates at least one cointegrating relationship among all three stocks.&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   - Cointegration suggests linked price movements, useful for pairs trading or portfolio management.&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   - No cointegration implies prices may drift apart, indicating independent trends.&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   - Cointegration Plots:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;     - Standardized Prices: Show price co-movement for each pair (saved as &#39;cointegration_prices_</span><span class="si">{pair}</span><span class="s2">.png&#39;).&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;     - Engle-Granger Residuals: Stationary residuals for cointegrated pairs (saved as &#39;cointegration_residual_</span><span class="si">{pair}</span><span class="s2">.png&#39;).&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;     - Johansen Cointegrating Relationship: Stationary series for all three stocks, if cointegrated (saved as &#39;johansen_cointegration.png&#39;).&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Note: If Johansen test fails, rely on pairwise Engle-Granger results. Ensure data is clean (no NaN, numeric). Review test statistics, p-values, plots, and forecasts carefully.&quot;</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">display</span><span class="p">,</span> <span class="n">HTML</span>
<span class="kn">import</span> <span class="nn">base64</span>
<span class="kn">from</span> <span class="nn">io</span> <span class="kn">import</span> <span class="n">BytesIO</span>

<span class="c1"># Function to convert plot to base64 string</span>
<span class="k">def</span> <span class="nf">plot_to_base64</span><span class="p">(</span><span class="n">fig</span><span class="p">):</span>
    <span class="n">buf</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">()</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;png&#39;</span><span class="p">)</span>
    <span class="n">buf</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">img_str</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">buf</span><span class="o">.</span><span class="n">read</span><span class="p">())</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
    <span class="n">buf</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">img_str</span>

<span class="c1"># Capture output as HTML</span>
<span class="n">html_content</span> <span class="o">=</span> <span class="s2">&quot;&lt;html&gt;&lt;head&gt;&lt;title&gt;Stock Analysis Results&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&quot;</span>
<span class="n">html_content</span> <span class="o">+=</span> <span class="s2">&quot;&lt;h1&gt;Stock Analysis Results&lt;/h1&gt;&quot;</span>

<span class="c1"># Add uploaded files</span>
<span class="n">html_content</span> <span class="o">+=</span> <span class="s2">&quot;&lt;h2&gt;Uploaded Files&lt;/h2&gt;&quot;</span>
<span class="n">html_content</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;&lt;p&gt;</span><span class="si">{</span><span class="p">[</span><span class="n">amazon_file</span><span class="p">,</span><span class="w"> </span><span class="n">nvda_file</span><span class="p">,</span><span class="w"> </span><span class="n">meta_file</span><span class="p">]</span><span class="si">}</span><span class="s2">&lt;/p&gt;&quot;</span>

<span class="c1"># Add unit root tests</span>
<span class="n">html_content</span> <span class="o">+=</span> <span class="s2">&quot;&lt;h2&gt;Unit Root Tests&lt;/h2&gt;&quot;</span>
<span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">series</span> <span class="ow">in</span> <span class="p">[(</span><span class="s2">&quot;Amazon&quot;</span><span class="p">,</span> <span class="n">amazon_close</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;NVDA&quot;</span><span class="p">,</span> <span class="n">nvda_close</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;Meta&quot;</span><span class="p">,</span> <span class="n">meta_close</span><span class="p">)]:</span>
    <span class="n">html_content</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;&lt;h3&gt;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&lt;/h3&gt;&quot;</span>
    <span class="n">adf_result</span> <span class="o">=</span> <span class="n">adfuller</span><span class="p">(</span><span class="n">series</span><span class="p">,</span> <span class="n">autolag</span><span class="o">=</span><span class="s1">&#39;AIC&#39;</span><span class="p">)</span>
    <span class="n">kpss_result</span> <span class="o">=</span> <span class="n">kpss</span><span class="p">(</span><span class="n">series</span><span class="p">,</span> <span class="n">regression</span><span class="o">=</span><span class="s1">&#39;c&#39;</span><span class="p">)</span>
    <span class="n">html_content</span> <span class="o">+=</span> <span class="s2">&quot;&lt;p&gt;ADF Test:&lt;br&gt;&quot;</span>
    <span class="n">html_content</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;Test Statistic: </span><span class="si">{</span><span class="n">adf_result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&lt;br&gt;&quot;</span>
    <span class="n">html_content</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;P-value: </span><span class="si">{</span><span class="n">adf_result</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&lt;br&gt;&quot;</span>
    <span class="n">html_content</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;Stationary&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">adf_result</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.05</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;Non-stationary&#39;</span><span class="si">}</span><span class="s2">&lt;/p&gt;&quot;</span>
    <span class="n">html_content</span> <span class="o">+=</span> <span class="s2">&quot;&lt;p&gt;KPSS Test:&lt;br&gt;&quot;</span>
    <span class="n">html_content</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;Test Statistic: </span><span class="si">{</span><span class="n">kpss_result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&lt;br&gt;&quot;</span>
    <span class="n">html_content</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;P-value: </span><span class="si">{</span><span class="n">kpss_result</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&lt;br&gt;&quot;</span>
    <span class="n">html_content</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;Stationary&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">kpss_result</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.05</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;Non-stationary&#39;</span><span class="si">}</span><span class="s2">&lt;/p&gt;&quot;</span>

<span class="c1"># Add correlograms</span>
<span class="n">html_content</span> <span class="o">+=</span> <span class="s2">&quot;&lt;h2&gt;Correlograms&lt;/h2&gt;&quot;</span>
<span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">series</span> <span class="ow">in</span> <span class="p">[(</span><span class="s2">&quot;Amazon&quot;</span><span class="p">,</span> <span class="n">amazon_series</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;NVDA&quot;</span><span class="p">,</span> <span class="n">nvda_series</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;Meta&quot;</span><span class="p">,</span> <span class="n">meta_series</span><span class="p">)]:</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">)</span>
    <span class="n">plot_acf</span><span class="p">(</span><span class="n">series</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">(),</span> <span class="n">lags</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;ACF - </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">)</span>
    <span class="n">plot_pacf</span><span class="p">(</span><span class="n">series</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">(),</span> <span class="n">lags</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;PACF - </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">html_content</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;&lt;h3&gt;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&lt;/h3&gt;&quot;</span>
    <span class="n">html_content</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;&lt;img src=&quot;data:image/png;base64,</span><span class="si">{</span><span class="n">plot_to_base64</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span><span class="si">}</span><span class="s1">&quot; alt=&quot;Correlogram </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">&quot;&gt;&#39;</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>

<span class="c1"># Add ARMA models and forecasts</span>
<span class="n">html_content</span> <span class="o">+=</span> <span class="s2">&quot;&lt;h2&gt;ARMA Models and Forecasts&lt;/h2&gt;&quot;</span>
<span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">series</span> <span class="ow">in</span> <span class="p">[(</span><span class="s2">&quot;Amazon&quot;</span><span class="p">,</span> <span class="n">amazon_series</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;NVDA&quot;</span><span class="p">,</span> <span class="n">nvda_series</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;Meta&quot;</span><span class="p">,</span> <span class="n">meta_series</span><span class="p">)]:</span>
    <span class="n">html_content</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;&lt;h3&gt;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&lt;/h3&gt;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">ARIMA</span><span class="p">(</span><span class="n">series</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
        <span class="n">html_content</span> <span class="o">+=</span> <span class="s2">&quot;&lt;p&gt;ARMA(1,1) Model Results:&lt;br&gt;&quot;</span>
        <span class="n">html_content</span> <span class="o">+=</span> <span class="n">results</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">as_html</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&lt;table&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;table border=&quot;1&quot;&gt;&#39;</span><span class="p">)</span>
        <span class="n">forecast</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">get_forecast</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">forecast_mean</span> <span class="o">=</span> <span class="n">forecast</span><span class="o">.</span><span class="n">predicted_mean</span>
        <span class="n">forecast_ci</span> <span class="o">=</span> <span class="n">forecast</span><span class="o">.</span><span class="n">conf_int</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
        <span class="n">forecast_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
            <span class="s1">&#39;Forecast&#39;</span><span class="p">:</span> <span class="n">forecast_mean</span><span class="p">,</span>
            <span class="s1">&#39;Lower CI&#39;</span><span class="p">:</span> <span class="n">forecast_ci</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="s1">&#39;Upper CI&#39;</span><span class="p">:</span> <span class="n">forecast_ci</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="p">})</span>
        <span class="n">html_content</span> <span class="o">+=</span> <span class="s2">&quot;&lt;br&gt;10-Step-Ahead Forecast:&lt;br&gt;&quot;</span>
        <span class="n">html_content</span> <span class="o">+=</span> <span class="n">forecast_df</span><span class="o">.</span><span class="n">to_html</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">border</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">html_content</span> <span class="o">+=</span> <span class="s2">&quot;&lt;/p&gt;&quot;</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">html_content</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;&lt;p&gt;Error fitting ARMA model for </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&lt;/p&gt;&quot;</span>

<span class="c1"># Add cointegration tests</span>
<span class="n">html_content</span> <span class="o">+=</span> <span class="s2">&quot;&lt;h2&gt;Cointegration Tests&lt;/h2&gt;&quot;</span>
<span class="k">for</span> <span class="p">(</span><span class="n">series1</span><span class="p">,</span> <span class="n">series2</span><span class="p">,</span> <span class="n">name1</span><span class="p">,</span> <span class="n">name2</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span>
    <span class="p">(</span><span class="n">amazon_close</span><span class="p">,</span> <span class="n">nvda_close</span><span class="p">,</span> <span class="s2">&quot;Amazon&quot;</span><span class="p">,</span> <span class="s2">&quot;NVDA&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="n">amazon_close</span><span class="p">,</span> <span class="n">meta_close</span><span class="p">,</span> <span class="s2">&quot;Amazon&quot;</span><span class="p">,</span> <span class="s2">&quot;Meta&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="n">nvda_close</span><span class="p">,</span> <span class="n">meta_close</span><span class="p">,</span> <span class="s2">&quot;NVDA&quot;</span><span class="p">,</span> <span class="s2">&quot;Meta&quot;</span><span class="p">)</span>
<span class="p">]:</span>
    <span class="n">html_content</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;&lt;h3&gt;</span><span class="si">{</span><span class="n">name1</span><span class="si">}</span><span class="s2"> vs </span><span class="si">{</span><span class="n">name2</span><span class="si">}</span><span class="s2">&lt;/h3&gt;&quot;</span>
    <span class="k">if</span> <span class="n">engle_granger</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">eg_result</span> <span class="o">=</span> <span class="n">engle_granger</span><span class="p">(</span><span class="n">series1</span><span class="p">,</span> <span class="n">series2</span><span class="p">)</span>
            <span class="n">html_content</span> <span class="o">+=</span> <span class="s2">&quot;&lt;p&gt;Engle-Granger Test:&lt;br&gt;&quot;</span>
            <span class="n">html_content</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;Test Statistic: </span><span class="si">{</span><span class="n">eg_result</span><span class="o">.</span><span class="n">stat</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&lt;br&gt;&quot;</span>
            <span class="n">html_content</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;P-value: </span><span class="si">{</span><span class="n">eg_result</span><span class="o">.</span><span class="n">pvalue</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&lt;br&gt;&quot;</span>
            <span class="n">html_content</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;Cointegrated&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">eg_result</span><span class="o">.</span><span class="n">pvalue</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.05</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;Not Cointegrated&#39;</span><span class="si">}</span><span class="s2">&lt;/p&gt;&quot;</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">html_content</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;&lt;p&gt;Engle-Granger test failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&lt;/p&gt;&quot;</span>

<span class="n">html_content</span> <span class="o">+=</span> <span class="s2">&quot;&lt;h3&gt;Amazon, NVDA, Meta (Johansen)&lt;/h3&gt;&quot;</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;Amazon&quot;</span><span class="p">:</span> <span class="n">amazon_close</span><span class="p">,</span> <span class="s2">&quot;NVDA&quot;</span><span class="p">:</span> <span class="n">nvda_close</span><span class="p">,</span> <span class="s2">&quot;Meta&quot;</span><span class="p">:</span> <span class="n">meta_close</span><span class="p">})</span>
    <span class="n">johansen_result</span> <span class="o">=</span> <span class="n">coint_johansen</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">det_order</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">k_ar_diff</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">html_content</span> <span class="o">+=</span> <span class="s2">&quot;&lt;p&gt;Johansen Test:&lt;br&gt;&quot;</span>
    <span class="n">html_content</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;Trace Statistic (r=0): </span><span class="si">{</span><span class="n">johansen_result</span><span class="o">.</span><span class="n">lr1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&lt;br&gt;&quot;</span>
    <span class="n">html_content</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;Critical Value (5%, r=0): </span><span class="si">{</span><span class="n">johansen_result</span><span class="o">.</span><span class="n">cvt</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&lt;br&gt;&quot;</span>
    <span class="n">html_content</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;Cointegrated (at least one relationship)&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">johansen_result</span><span class="o">.</span><span class="n">lr1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">johansen_result</span><span class="o">.</span><span class="n">cvt</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;Not Cointegrated&#39;</span><span class="si">}</span><span class="s2">&lt;/p&gt;&quot;</span>
<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="n">html_content</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;&lt;p&gt;Johansen test failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&lt;/p&gt;&quot;</span>

<span class="c1"># Add cointegration plots</span>
<span class="n">html_content</span> <span class="o">+=</span> <span class="s2">&quot;&lt;h2&gt;Cointegration Plots&lt;/h2&gt;&quot;</span>
<span class="k">for</span> <span class="p">(</span><span class="n">series1</span><span class="p">,</span> <span class="n">series2</span><span class="p">,</span> <span class="n">name1</span><span class="p">,</span> <span class="n">name2</span><span class="p">,</span> <span class="n">pair_suffix</span><span class="p">,</span> <span class="n">eg_result</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span>
    <span class="p">(</span><span class="n">amazon_close</span><span class="p">,</span> <span class="n">nvda_close</span><span class="p">,</span> <span class="s2">&quot;Amazon&quot;</span><span class="p">,</span> <span class="s2">&quot;NVDA&quot;</span><span class="p">,</span> <span class="s2">&quot;amzn_nvda&quot;</span><span class="p">,</span> <span class="n">eg_result_amzn_nvda</span><span class="p">),</span>
    <span class="p">(</span><span class="n">amazon_close</span><span class="p">,</span> <span class="n">meta_close</span><span class="p">,</span> <span class="s2">&quot;Amazon&quot;</span><span class="p">,</span> <span class="s2">&quot;Meta&quot;</span><span class="p">,</span> <span class="s2">&quot;amzn_meta&quot;</span><span class="p">,</span> <span class="n">eg_result_amzn_meta</span><span class="p">),</span>
    <span class="p">(</span><span class="n">nvda_close</span><span class="p">,</span> <span class="n">meta_close</span><span class="p">,</span> <span class="s2">&quot;NVDA&quot;</span><span class="p">,</span> <span class="s2">&quot;Meta&quot;</span><span class="p">,</span> <span class="s2">&quot;nvda_meta&quot;</span><span class="p">,</span> <span class="n">eg_result_nvda_meta</span><span class="p">)</span>
<span class="p">]:</span>
    <span class="n">html_content</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;&lt;h3&gt;</span><span class="si">{</span><span class="n">name1</span><span class="si">}</span><span class="s2"> vs </span><span class="si">{</span><span class="n">name2</span><span class="si">}</span><span class="s2">&lt;/h3&gt;&quot;</span>
    <span class="c1"># Standardized prices</span>
    <span class="n">series1_std</span> <span class="o">=</span> <span class="p">(</span><span class="n">series1</span> <span class="o">-</span> <span class="n">series1</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span> <span class="o">/</span> <span class="n">series1</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
    <span class="n">series2_std</span> <span class="o">=</span> <span class="p">(</span><span class="n">series2</span> <span class="o">-</span> <span class="n">series2</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span> <span class="o">/</span> <span class="n">series2</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">series1_std</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">name1</span><span class="si">}</span><span class="s1"> (standardized)&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">series2_std</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">name2</span><span class="si">}</span><span class="s1"> (standardized)&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Standardized Closing Prices: </span><span class="si">{</span><span class="n">name1</span><span class="si">}</span><span class="s1"> vs </span><span class="si">{</span><span class="n">name2</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Standardized Price&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">html_content</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;&lt;img src=&quot;data:image/png;base64,</span><span class="si">{</span><span class="n">plot_to_base64</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span><span class="si">}</span><span class="s1">&quot; alt=&quot;Cointegration Prices </span><span class="si">{</span><span class="n">name1</span><span class="si">}</span><span class="s1"> vs </span><span class="si">{</span><span class="n">name2</span><span class="si">}</span><span class="s1">&quot;&gt;&#39;</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
    <span class="c1"># Engle-Granger residual</span>
    <span class="k">if</span> <span class="n">eg_result</span> <span class="ow">and</span> <span class="n">eg_result</span><span class="o">.</span><span class="n">pvalue</span> <span class="o">&lt;</span> <span class="mf">0.05</span><span class="p">:</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">eg_result</span><span class="o">.</span><span class="n">resid</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Engle-Granger Cointegration Residual&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Engle-Granger Cointegration Residual: </span><span class="si">{</span><span class="n">name1</span><span class="si">}</span><span class="s1"> vs </span><span class="si">{</span><span class="n">name2</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Residual&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">html_content</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;&lt;img src=&quot;data:image/png;base64,</span><span class="si">{</span><span class="n">plot_to_base64</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span><span class="si">}</span><span class="s1">&quot; alt=&quot;Engle-Granger Residual </span><span class="si">{</span><span class="n">name1</span><span class="si">}</span><span class="s1"> vs </span><span class="si">{</span><span class="n">name2</span><span class="si">}</span><span class="s1">&quot;&gt;&#39;</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>

<span class="c1"># Johansen cointegration plot</span>
<span class="n">html_content</span> <span class="o">+=</span> <span class="s2">&quot;&lt;h3&gt;Johansen Cointegrating Relationship&lt;/h3&gt;&quot;</span>
<span class="k">if</span> <span class="n">johansen_result</span> <span class="ow">and</span> <span class="n">johansen_result</span><span class="o">.</span><span class="n">lr1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">johansen_result</span><span class="o">.</span><span class="n">cvt</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]:</span>
    <span class="n">weights</span> <span class="o">=</span> <span class="n">johansen_result</span><span class="o">.</span><span class="n">evec</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">cointegrating_series</span> <span class="o">=</span> <span class="n">amazon_close</span> <span class="o">*</span> <span class="n">weights</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">nvda_close</span> <span class="o">*</span> <span class="n">weights</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">meta_close</span> <span class="o">*</span> <span class="n">weights</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">cointegrating_series</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Johansen Cointegrating Relationship&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;purple&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">cointegrating_series</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Johansen Cointegrating Relationship: Amazon, NVDA, Meta&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Cointegrating Series&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">html_content</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;&lt;img src=&quot;data:image/png;base64,</span><span class="si">{</span><span class="n">plot_to_base64</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span><span class="si">}</span><span class="s1">&quot; alt=&quot;Johansen Cointegration&quot;&gt;&#39;</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">html_content</span> <span class="o">+=</span> <span class="s2">&quot;&lt;p&gt;No Johansen cointegration plot (no cointegration or test failed).&lt;/p&gt;&quot;</span>

<span class="c1"># Add interpretation</span>
<span class="n">html_content</span> <span class="o">+=</span> <span class="s2">&quot;&lt;h2&gt;Interpretation&lt;/h2&gt;&quot;</span>
<span class="n">html_content</span> <span class="o">+=</span> <span class="s2">&quot;&lt;p&gt;&quot;</span> <span class="o">+</span> <span class="s2">&quot;&lt;br&gt;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span>
    <span class="s2">&quot;1. Unit Root Tests:&quot;</span><span class="p">,</span>
    <span class="s2">&quot;   - ADF Test: P-value &lt; 0.05 suggests stationarity (rejects non-stationarity).&quot;</span><span class="p">,</span>
    <span class="s2">&quot;   - KPSS Test: P-value &gt; 0.05 suggests stationarity (fails to reject stationarity).&quot;</span><span class="p">,</span>
    <span class="s2">&quot;   - Non-stationary series were differenced for ARMA modeling.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;2. Correlograms:&quot;</span><span class="p">,</span>
    <span class="s2">&quot;   - ACF and PACF plots show the correlation structure for Amazon, NVDA, and Meta.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;   - Significant spikes at early lags (e.g., lag 1) justify the ARMA(1,1) model.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;   - Plots saved as &#39;correlogram_</span><span class="si">{stock}</span><span class="s2">.png&#39;.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;3. ARMA Models:&quot;</span><span class="p">,</span>
    <span class="s2">&quot;   - ARMA(1,1) models capture short-term price dynamics for each stock.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;   - Significant coefficients (p &lt; 0.05) indicate a good fit.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;   - Check model diagnostics in the summary for adequacy.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;4. Forecasts:&quot;</span><span class="p">,</span>
    <span class="s2">&quot;   - 10-step-ahead forecasts (10 minutes for 1-min data) predict price movements.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;   - Confidence intervals show the range of uncertainty; wider intervals indicate higher uncertainty.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;5. Cointegration:&quot;</span><span class="p">,</span>
    <span class="s2">&quot;   - Tests for stable long-run relationships between Amazon, NVDA, and Meta.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;   - Pairwise Engle-Granger Tests: P-value &lt; 0.05 indicates cointegration for each pair (Amazon-NVDA, Amazon-Meta, NVDA-Meta).&quot;</span><span class="p">,</span>
    <span class="s2">&quot;   - Johansen Test: Trace statistic &gt; critical value (5%) indicates at least one cointegrating relationship among all three stocks.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;   - Cointegration suggests linked price movements, useful for pairs trading or portfolio management.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;   - No cointegration implies prices may drift apart, indicating independent trends.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;   - Cointegration Plots:&quot;</span><span class="p">,</span>
    <span class="s2">&quot;     - Standardized Prices: Show price co-movement for each pair (saved as &#39;cointegration_prices_</span><span class="si">{pair}</span><span class="s2">.png&#39;).&quot;</span><span class="p">,</span>
    <span class="s2">&quot;     - Engle-Granger Residuals: Stationary residuals for cointegrated pairs (saved as &#39;cointegration_residual_</span><span class="si">{pair}</span><span class="s2">.png&#39;).&quot;</span><span class="p">,</span>
    <span class="s2">&quot;     - Johansen Cointegrating Relationship: Stationary series for all three stocks, if cointegrated (saved as &#39;johansen_cointegration.png&#39;).&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Note: If Johansen test fails, rely on pairwise Engle-Granger results. Ensure data is clean (no NaN, numeric). Review test statistics, p-values, plots, and forecasts carefully.&quot;</span>
<span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;&lt;/p&gt;&quot;</span>

<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">display</span><span class="p">,</span> <span class="n">HTML</span>
<span class="kn">import</span> <span class="nn">base64</span>
<span class="kn">from</span> <span class="nn">io</span> <span class="kn">import</span> <span class="n">BytesIO</span>

<span class="c1"># Function to convert plot to base64 string</span>
<span class="k">def</span> <span class="nf">plot_to_base64</span><span class="p">(</span><span class="n">fig</span><span class="p">):</span>
    <span class="n">buf</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">()</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;png&#39;</span><span class="p">)</span>
    <span class="n">buf</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">img_str</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">buf</span><span class="o">.</span><span class="n">read</span><span class="p">())</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
    <span class="n">buf</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">img_str</span>

<span class="c1"># Capture output as HTML</span>
<span class="n">html_content</span> <span class="o">=</span> <span class="s2">&quot;&lt;html&gt;&lt;head&gt;&lt;title&gt;Stock Analysis Results&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&quot;</span>
<span class="n">html_content</span> <span class="o">+=</span> <span class="s2">&quot;&lt;h1&gt;Stock Analysis Results&lt;/h1&gt;&quot;</span>

<span class="c1"># Add uploaded files</span>
<span class="n">html_content</span> <span class="o">+=</span> <span class="s2">&quot;&lt;h2&gt;Uploaded Files&lt;/h2&gt;&quot;</span>
<span class="n">html_content</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;&lt;p&gt;</span><span class="si">{</span><span class="p">[</span><span class="n">amazon_file</span><span class="p">,</span><span class="w"> </span><span class="n">nvda_file</span><span class="p">,</span><span class="w"> </span><span class="n">meta_file</span><span class="p">]</span><span class="si">}</span><span class="s2">&lt;/p&gt;&quot;</span>

<span class="c1"># Add unit root tests</span>
<span class="n">html_content</span> <span class="o">+=</span> <span class="s2">&quot;&lt;h2&gt;Unit Root Tests&lt;/h2&gt;&quot;</span>
<span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">series</span> <span class="ow">in</span> <span class="p">[(</span><span class="s2">&quot;Amazon&quot;</span><span class="p">,</span> <span class="n">amazon_close</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;NVDA&quot;</span><span class="p">,</span> <span class="n">nvda_close</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;Meta&quot;</span><span class="p">,</span> <span class="n">meta_close</span><span class="p">)]:</span>
    <span class="n">html_content</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;&lt;h3&gt;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&lt;/h3&gt;&quot;</span>
    <span class="n">adf_result</span> <span class="o">=</span> <span class="n">adfuller</span><span class="p">(</span><span class="n">series</span><span class="p">,</span> <span class="n">autolag</span><span class="o">=</span><span class="s1">&#39;AIC&#39;</span><span class="p">)</span>
    <span class="n">kpss_result</span> <span class="o">=</span> <span class="n">kpss</span><span class="p">(</span><span class="n">series</span><span class="p">,</span> <span class="n">regression</span><span class="o">=</span><span class="s1">&#39;c&#39;</span><span class="p">)</span>
    <span class="n">html_content</span> <span class="o">+=</span> <span class="s2">&quot;&lt;p&gt;ADF Test:&lt;br&gt;&quot;</span>
    <span class="n">html_content</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;Test Statistic: </span><span class="si">{</span><span class="n">adf_result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&lt;br&gt;&quot;</span>
    <span class="n">html_content</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;P-value: </span><span class="si">{</span><span class="n">adf_result</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&lt;br&gt;&quot;</span>
    <span class="n">html_content</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;Stationary&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">adf_result</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.05</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;Non-stationary&#39;</span><span class="si">}</span><span class="s2">&lt;/p&gt;&quot;</span>
    <span class="n">html_content</span> <span class="o">+=</span> <span class="s2">&quot;&lt;p&gt;KPSS Test:&lt;br&gt;&quot;</span>
    <span class="n">html_content</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;Test Statistic: </span><span class="si">{</span><span class="n">kpss_result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&lt;br&gt;&quot;</span>
    <span class="n">html_content</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;P-value: </span><span class="si">{</span><span class="n">kpss_result</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&lt;br&gt;&quot;</span>
    <span class="n">html_content</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;Stationary&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">kpss_result</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.05</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;Non-stationary&#39;</span><span class="si">}</span><span class="s2">&lt;/p&gt;&quot;</span>

<span class="c1"># Add correlograms</span>
<span class="n">html_content</span> <span class="o">+=</span> <span class="s2">&quot;&lt;h2&gt;Correlograms&lt;/h2&gt;&quot;</span>
<span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">series</span> <span class="ow">in</span> <span class="p">[(</span><span class="s2">&quot;Amazon&quot;</span><span class="p">,</span> <span class="n">amazon_series</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;NVDA&quot;</span><span class="p">,</span> <span class="n">nvda_series</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;Meta&quot;</span><span class="p">,</span> <span class="n">meta_series</span><span class="p">)]:</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">)</span>
    <span class="n">plot_acf</span><span class="p">(</span><span class="n">series</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">(),</span> <span class="n">lags</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;ACF - </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">)</span>
    <span class="n">plot_pacf</span><span class="p">(</span><span class="n">series</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">(),</span> <span class="n">lags</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;PACF - </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">html_content</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;&lt;h3&gt;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&lt;/h3&gt;&quot;</span>
    <span class="n">html_content</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;&lt;img src=&quot;data:image/png;base64,</span><span class="si">{</span><span class="n">plot_to_base64</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span><span class="si">}</span><span class="s1">&quot; alt=&quot;Correlogram </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">&quot;&gt;&#39;</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>

<span class="c1"># Add ARMA models and forecasts</span>
<span class="n">html_content</span> <span class="o">+=</span> <span class="s2">&quot;&lt;h2&gt;ARMA Models and Forecasts&lt;/h2&gt;&quot;</span>
<span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">series</span> <span class="ow">in</span> <span class="p">[(</span><span class="s2">&quot;Amazon&quot;</span><span class="p">,</span> <span class="n">amazon_series</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;NVDA&quot;</span><span class="p">,</span> <span class="n">nvda_series</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;Meta&quot;</span><span class="p">,</span> <span class="n">meta_series</span><span class="p">)]:</span>
    <span class="n">html_content</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;&lt;h3&gt;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&lt;/h3&gt;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">ARIMA</span><span class="p">(</span><span class="n">series</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
        <span class="n">html_content</span> <span class="o">+=</span> <span class="s2">&quot;&lt;p&gt;ARMA(1,1) Model Results:&lt;br&gt;&quot;</span>
        <span class="n">html_content</span> <span class="o">+=</span> <span class="n">results</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">as_html</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&lt;table&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;table border=&quot;1&quot;&gt;&#39;</span><span class="p">)</span>
        <span class="n">forecast</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">get_forecast</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">forecast_mean</span> <span class="o">=</span> <span class="n">forecast</span><span class="o">.</span><span class="n">predicted_mean</span>
        <span class="n">forecast_ci</span> <span class="o">=</span> <span class="n">forecast</span><span class="o">.</span><span class="n">conf_int</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
        <span class="n">forecast_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
            <span class="s1">&#39;Forecast&#39;</span><span class="p">:</span> <span class="n">forecast_mean</span><span class="p">,</span>
            <span class="s1">&#39;Lower CI&#39;</span><span class="p">:</span> <span class="n">forecast_ci</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="s1">&#39;Upper CI&#39;</span><span class="p">:</span> <span class="n">forecast_ci</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="p">})</span>
        <span class="n">html_content</span> <span class="o">+=</span> <span class="s2">&quot;&lt;br&gt;10-Step-Ahead Forecast:&lt;br&gt;&quot;</span>
        <span class="n">html_content</span> <span class="o">+=</span> <span class="n">forecast_df</span><span class="o">.</span><span class="n">to_html</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">border</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">html_content</span> <span class="o">+=</span> <span class="s2">&quot;&lt;/p&gt;&quot;</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">html_content</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;&lt;p&gt;Error fitting ARMA model for </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&lt;/p&gt;&quot;</span>

<span class="c1"># Add cointegration tests</span>
<span class="n">html_content</span> <span class="o">+=</span> <span class="s2">&quot;&lt;h2&gt;Cointegration Tests&lt;/h2&gt;&quot;</span>
<span class="k">for</span> <span class="p">(</span><span class="n">series1</span><span class="p">,</span> <span class="n">series2</span><span class="p">,</span> <span class="n">name1</span><span class="p">,</span> <span class="n">name2</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span>
    <span class="p">(</span><span class="n">amazon_close</span><span class="p">,</span> <span class="n">nvda_close</span><span class="p">,</span> <span class="s2">&quot;Amazon&quot;</span><span class="p">,</span> <span class="s2">&quot;NVDA&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="n">amazon_close</span><span class="p">,</span> <span class="n">meta_close</span><span class="p">,</span> <span class="s2">&quot;Amazon&quot;</span><span class="p">,</span> <span class="s2">&quot;Meta&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="n">nvda_close</span><span class="p">,</span> <span class="n">meta_close</span><span class="p">,</span> <span class="s2">&quot;NVDA&quot;</span><span class="p">,</span> <span class="s2">&quot;Meta&quot;</span><span class="p">)</span>
<span class="p">]:</span>
    <span class="n">html_content</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;&lt;h3&gt;</span><span class="si">{</span><span class="n">name1</span><span class="si">}</span><span class="s2"> vs </span><span class="si">{</span><span class="n">name2</span><span class="si">}</span><span class="s2">&lt;/h3&gt;&quot;</span>
    <span class="k">if</span> <span class="n">engle_granger</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">eg_result</span> <span class="o">=</span> <span class="n">engle_granger</span><span class="p">(</span><span class="n">series1</span><span class="p">,</span> <span class="n">series2</span><span class="p">)</span>
            <span class="n">html_content</span> <span class="o">+=</span> <span class="s2">&quot;&lt;p&gt;Engle-Granger Test:&lt;br&gt;&quot;</span>
            <span class="n">html_content</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;Test Statistic: </span><span class="si">{</span><span class="n">eg_result</span><span class="o">.</span><span class="n">stat</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&lt;br&gt;&quot;</span>
            <span class="n">html_content</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;P-value: </span><span class="si">{</span><span class="n">eg_result</span><span class="o">.</span><span class="n">pvalue</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&lt;br&gt;&quot;</span>
            <span class="n">html_content</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;Cointegrated&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">eg_result</span><span class="o">.</span><span class="n">pvalue</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.05</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;Not Cointegrated&#39;</span><span class="si">}</span><span class="s2">&lt;/p&gt;&quot;</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">html_content</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;&lt;p&gt;Engle-Granger test failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&lt;/p&gt;&quot;</span>

<span class="n">html_content</span> <span class="o">+=</span> <span class="s2">&quot;&lt;h3&gt;Amazon, NVDA, Meta (Johansen)&lt;/h3&gt;&quot;</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;Amazon&quot;</span><span class="p">:</span> <span class="n">amazon_close</span><span class="p">,</span> <span class="s2">&quot;NVDA&quot;</span><span class="p">:</span> <span class="n">nvda_close</span><span class="p">,</span> <span class="s2">&quot;Meta&quot;</span><span class="p">:</span> <span class="n">meta_close</span><span class="p">})</span>
    <span class="n">johansen_result</span> <span class="o">=</span> <span class="n">coint_johansen</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">det_order</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">k_ar_diff</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">html_content</span> <span class="o">+=</span> <span class="s2">&quot;&lt;p&gt;Johansen Test:&lt;br&gt;&quot;</span>
    <span class="n">html_content</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;Trace Statistic (r=0): </span><span class="si">{</span><span class="n">johansen_result</span><span class="o">.</span><span class="n">lr1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&lt;br&gt;&quot;</span>
    <span class="n">html_content</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;Critical Value (5%, r=0): </span><span class="si">{</span><span class="n">johansen_result</span><span class="o">.</span><span class="n">cvt</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&lt;br&gt;&quot;</span>
    <span class="n">html_content</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;Cointegrated (at least one relationship)&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">johansen_result</span><span class="o">.</span><span class="n">lr1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">johansen_result</span><span class="o">.</span><span class="n">cvt</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;Not Cointegrated&#39;</span><span class="si">}</span><span class="s2">&lt;/p&gt;&quot;</span>
<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="n">html_content</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;&lt;p&gt;Johansen test failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&lt;/p&gt;&quot;</span>

<span class="c1"># Add cointegration plots</span>
<span class="n">html_content</span> <span class="o">+=</span> <span class="s2">&quot;&lt;h2&gt;Cointegration Plots&lt;/h2&gt;&quot;</span>
<span class="k">for</span> <span class="p">(</span><span class="n">series1</span><span class="p">,</span> <span class="n">series2</span><span class="p">,</span> <span class="n">name1</span><span class="p">,</span> <span class="n">name2</span><span class="p">,</span> <span class="n">pair_suffix</span><span class="p">,</span> <span class="n">eg_result</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span>
    <span class="p">(</span><span class="n">amazon_close</span><span class="p">,</span> <span class="n">nvda_close</span><span class="p">,</span> <span class="s2">&quot;Amazon&quot;</span><span class="p">,</span> <span class="s2">&quot;NVDA&quot;</span><span class="p">,</span> <span class="s2">&quot;amzn_nvda&quot;</span><span class="p">,</span> <span class="n">eg_result_amzn_nvda</span><span class="p">),</span>
    <span class="p">(</span><span class="n">amazon_close</span><span class="p">,</span> <span class="n">meta_close</span><span class="p">,</span> <span class="s2">&quot;Amazon&quot;</span><span class="p">,</span> <span class="s2">&quot;Meta&quot;</span><span class="p">,</span> <span class="s2">&quot;amzn_meta&quot;</span><span class="p">,</span> <span class="n">eg_result_amzn_meta</span><span class="p">),</span>
    <span class="p">(</span><span class="n">nvda_close</span><span class="p">,</span> <span class="n">meta_close</span><span class="p">,</span> <span class="s2">&quot;NVDA&quot;</span><span class="p">,</span> <span class="s2">&quot;Meta&quot;</span><span class="p">,</span> <span class="s2">&quot;nvda_meta&quot;</span><span class="p">,</span> <span class="n">eg_result_nvda_meta</span><span class="p">)</span>
<span class="p">]:</span>
    <span class="n">html_content</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;&lt;h3&gt;</span><span class="si">{</span><span class="n">name1</span><span class="si">}</span><span class="s2"> vs </span><span class="si">{</span><span class="n">name2</span><span class="si">}</span><span class="s2">&lt;/h3&gt;&quot;</span>
    <span class="c1"># Standardized prices</span>
    <span class="n">series1_std</span> <span class="o">=</span> <span class="p">(</span><span class="n">series1</span> <span class="o">-</span> <span class="n">series1</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span> <span class="o">/</span> <span class="n">series1</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
    <span class="n">series2_std</span> <span class="o">=</span> <span class="p">(</span><span class="n">series2</span> <span class="o">-</span> <span class="n">series2</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span> <span class="o">/</span> <span class="n">series2</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">series1_std</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">name1</span><span class="si">}</span><span class="s1"> (standardized)&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">series2_std</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">name2</span><span class="si">}</span><span class="s1"> (standardized)&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Standardized Closing Prices: </span><span class="si">{</span><span class="n">name1</span><span class="si">}</span><span class="s1"> vs </span><span class="si">{</span><span class="n">name2</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Standardized Price&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">html_content</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;&lt;img src=&quot;data:image/png;base64,</span><span class="si">{</span><span class="n">plot_to_base64</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span><span class="si">}</span><span class="s1">&quot; alt=&quot;Cointegration Prices </span><span class="si">{</span><span class="n">name1</span><span class="si">}</span><span class="s1"> vs </span><span class="si">{</span><span class="n">name2</span><span class="si">}</span><span class="s1">&quot;&gt;&#39;</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
    <span class="c1"># Engle-Granger residual</span>
    <span class="k">if</span> <span class="n">eg_result</span> <span class="ow">and</span> <span class="n">eg_result</span><span class="o">.</span><span class="n">pvalue</span> <span class="o">&lt;</span> <span class="mf">0.05</span><span class="p">:</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">eg_result</span><span class="o">.</span><span class="n">resid</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Engle-Granger Cointegration Residual&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Engle-Granger Cointegration Residual: </span><span class="si">{</span><span class="n">name1</span><span class="si">}</span><span class="s1"> vs </span><span class="si">{</span><span class="n">name2</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Residual&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">html_content</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;&lt;img src=&quot;data:image/png;base64,</span><span class="si">{</span><span class="n">plot_to_base64</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span><span class="si">}</span><span class="s1">&quot; alt=&quot;Engle-Granger Residual </span><span class="si">{</span><span class="n">name1</span><span class="si">}</span><span class="s1"> vs </span><span class="si">{</span><span class="n">name2</span><span class="si">}</span><span class="s1">&quot;&gt;&#39;</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>

<span class="c1"># Johansen cointegration plot</span>
<span class="n">html_content</span> <span class="o">+=</span> <span class="s2">&quot;&lt;h3&gt;Johansen Cointegrating Relationship&lt;/h3&gt;&quot;</span>
<span class="k">if</span> <span class="n">johansen_result</span> <span class="ow">and</span> <span class="n">johansen_result</span><span class="o">.</span><span class="n">lr1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">johansen_result</span><span class="o">.</span><span class="n">cvt</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]:</span>
    <span class="n">weights</span> <span class="o">=</span> <span class="n">johansen_result</span><span class="o">.</span><span class="n">evec</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">cointegrating_series</span> <span class="o">=</span> <span class="n">amazon_close</span> <span class="o">*</span> <span class="n">weights</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">nvda_close</span> <span class="o">*</span> <span class="n">weights</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">meta_close</span> <span class="o">*</span> <span class="n">weights</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">cointegrating_series</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Johansen Cointegrating Relationship&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;purple&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">cointegrating_series</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Johansen Cointegrating Relationship: Amazon, NVDA, Meta&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Cointegrating Series&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">html_content</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;&lt;img src=&quot;data:image/png;base64,</span><span class="si">{</span><span class="n">plot_to_base64</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span><span class="si">}</span><span class="s1">&quot; alt=&quot;Johansen Cointegration&quot;&gt;&#39;</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">html_content</span> <span class="o">+=</span> <span class="s2">&quot;&lt;p&gt;No Johansen cointegration plot (no cointegration or test failed).&lt;/p&gt;&quot;</span>

<span class="c1"># Add interpretation</span>
<span class="n">html_content</span> <span class="o">+=</span> <span class="s2">&quot;&lt;h2&gt;Interpretation&lt;/h2&gt;&quot;</span>
<span class="n">html_content</span> <span class="o">+=</span> <span class="s2">&quot;&lt;p&gt;&quot;</span> <span class="o">+</span> <span class="s2">&quot;&lt;br&gt;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span>
    <span class="s2">&quot;1. Unit Root Tests:&quot;</span><span class="p">,</span>
    <span class="s2">&quot;   - ADF Test: P-value &lt; 0.05 suggests stationarity (rejects non-stationarity).&quot;</span><span class="p">,</span>
    <span class="s2">&quot;   - KPSS Test: P-value &gt; 0.05 suggests stationarity (fails to reject stationarity).&quot;</span><span class="p">,</span>
    <span class="s2">&quot;   - Non-stationary series were differenced for ARMA modeling.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;2. Correlograms:&quot;</span><span class="p">,</span>
    <span class="s2">&quot;   - ACF and PACF plots show the correlation structure for Amazon, NVDA, and Meta.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;   - Significant spikes at early lags (e.g., lag 1) justify the ARMA(1,1) model.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;   - Plots saved as &#39;correlogram_</span><span class="si">{stock}</span><span class="s2">.png&#39;.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;3. ARMA Models:&quot;</span><span class="p">,</span>
    <span class="s2">&quot;   - ARMA(1,1) models capture short-term price dynamics for each stock.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;   - Significant coefficients (p &lt; 0.05) indicate a good fit.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;   - Check model diagnostics in the summary for adequacy.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;4. Forecasts:&quot;</span><span class="p">,</span>
    <span class="s2">&quot;   - 10-step-ahead forecasts (10 minutes for 1-min data) predict price movements.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;   - Confidence intervals show the range of uncertainty; wider intervals indicate higher uncertainty.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;5. Cointegration:&quot;</span><span class="p">,</span>
    <span class="s2">&quot;   - Tests for stable long-run relationships between Amazon, NVDA, and Meta.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;   - Pairwise Engle-Granger Tests: P-value &lt; 0.05 indicates cointegration for each pair (Amazon-NVDA, Amazon-Meta, NVDA-Meta).&quot;</span><span class="p">,</span>
    <span class="s2">&quot;   - Johansen Test: Trace statistic &gt; critical value (5%) indicates at least one cointegrating relationship among all three stocks.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;   - Cointegration suggests linked price movements, useful for pairs trading or portfolio management.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;   - No cointegration implies prices may drift apart, indicating independent trends.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;   - Cointegration Plots:&quot;</span><span class="p">,</span>
    <span class="s2">&quot;     - Standardized Prices: Show price co-movement for each pair (saved as &#39;cointegration_prices_</span><span class="si">{pair}</span><span class="s2">.png&#39;).&quot;</span><span class="p">,</span>
    <span class="s2">&quot;     - Engle-Granger Residuals: Stationary residuals for cointegrated pairs (saved as &#39;cointegration_residual_</span><span class="si">{pair}</span><span class="s2">.png&#39;).&quot;</span><span class="p">,</span>
    <span class="s2">&quot;     - Johansen Cointegrating Relationship: Stationary series for all three stocks, if cointegrated (saved as &#39;johansen_cointegration.png&#39;).&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Note: If Johansen test fails, rely on pairwise Engle-Granger results. Ensure data is clean (no NaN, numeric). Review test statistics, p-values, plots, and forecasts carefully.&quot;</span>
<span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;&lt;/p&gt;&quot;</span>
</pre></div>
</body>
</html>
